<link rel="import" href="../polymer/polymer.html">
<!--
  A web-component grid layout of filterable items.

  Example:

  ```html
    <app-grid 
      item-size="64">
    </app-grid>
  ```

  @demo
-->
<dom-module id="app-grid">
  <template>
    <style>
      :host {
        display: block;
        border: 1px solid red;
      }
      #grid {
        position: relative;
      }
      #grid > div {
        display: block;
        position: absolute;
        border: 1px solid gray;
        transition: top 1s, left 1s, opacity 1s;
      }
    </style>
    <div id="grid">
      <div>item1</div>
      <div>item2</div>
      <div>item3</div>
      <div>item4</div>
      <div>item5</div>
      <div>item6</div>
      <div>item7</div>
      <div>item8</div>
      <div>item9</div>
      <div>item10</div>
      <div>item11</div>
      <div>item12</div>
      <div>item13</div>
      <div>item14</div>
      <div>item15</div>
      <div>item16</div>
    </div>
  </template>
  <script>
    Polymer({
      is: 'app-grid',

      properties: {
        /**
         * The rectangular size of each item in the grid
         */
        itemSize: {
          type: Number,
          value: 128
          // TODO check if supplied number is positive
        },
        /**
         * The rectangular margin of each item in the grid
         */
        itemMargin: {
          type: Number,
          value: 16
          // TODO check if supplied number is positive
        }
      },

      ready: function() {
        var gridEl, itemEls, itemEl, k;

        gridEl = Polymer.dom(this.$.grid);
        itemEls = gridEl.children;
        for (k = 0; k < itemEls.length; k++) {
          itemEl = itemEls[k];
          itemEl.style.width = itemEl.style.height = this.itemSize + 'px';
          itemEl.style.opacity = 0;
          //itemEl.style.top = 0;
          //itemEl.style.left = 0;
        }
      },

      attached: function() {
        var gridEl, itemEls, boxSize, width, cols, offset, itemEl, colIdx, rowIdx, k;

        gridEl = Polymer.dom(this.$.grid);
        itemEls = gridEl.children;

        boxSize = this.itemSize + this.itemMargin;
        width = gridEl.node.getBoundingClientRect().width;
        cols = Math.floor(width / boxSize);
        offset = (width - (cols * boxSize)) / 2;
        
        for (k = 0; k < itemEls.length; k++) {
          itemEl = itemEls[k];
          colIdx = Math.floor(k % cols);
          rowIdx = Math.floor(k / cols);
          itemEl.style.opacity = 1;
          itemEl.style.top = (this.itemMargin + (boxSize * rowIdx)) + 'px';
          itemEl.style.left = (offset + (boxSize * colIdx)) + 'px';
        }
        gridEl.node.style.height = (this.itemMargin + (boxSize * (rowIdx + 1))) + 'px';
      }
    });
  </script>
</dom-module>